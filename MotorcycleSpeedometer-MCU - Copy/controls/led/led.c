/*
 * Camp Chef
 * Copyright (C) 2022, All rights reserved.
 *
 * controls
 *   led.c
 */

//==============================================================================
// Notes
//==============================================================================


//==============================================================================
// Includes
//==============================================================================
#include "config.h"
#include "led.h"

#include "FreeRTOS.h"
#include "task.h"

#include "stm32f1xx_hal_gpio.h"
#include "stm32f1xx_hal_rcc.h"

//==============================================================================
// Definitions
//==============================================================================


//==============================================================================
// Enumerations and Structures
//==============================================================================


//==============================================================================
// Function Prototypes
//==============================================================================
static void led_init(void);

//==============================================================================
// Variables
//==============================================================================


//==============================================================================
// Public Functions
//==============================================================================


//==============================================================================
// Private Functions
//==============================================================================
void led_init() {
	// Initialize GPIO pin
	LED_CLOCK_ENABLE();

	GPIO_InitTypeDef gpio = (GPIO_InitTypeDef) {
		.Pin = 1 << LED_PIN,
		.Mode = GPIO_MODE_OUTPUT_PP,
		.Speed = GPIO_SPEED_HIGH
	};
	HAL_GPIO_Init(LED_PORT, &gpio);

	HAL_GPIO_WritePin(LED_PORT, 1 << LED_PIN, GPIO_PIN_RESET);

}

//==============================================================================
// Task Handler
//==============================================================================
void Led_TaskHandler(void* p) {
	led_init();

	TickType_t lastWakeTime = xTaskGetTickCount();

	while(1) {
		vTaskDelayUntil(&lastWakeTime, pdMS_TO_TICKS(1000));

		HAL_GPIO_TogglePin(LED_PORT, 1 << LED_PIN);
	}
}

//==============================================================================
// Interrupt
//==============================================================================

